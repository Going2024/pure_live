name: è¿è¡Œ Releases åŒæ­¥è„šæœ¬

  env:
    GH_TOKEN: ${{ secrets.GH_PAT }}
  run: |
    python3 -c "
    import os
    import requests
    from github import Github, GithubException

    # é…ç½®å‚æ•°
    UPSTREAM_REPO = 'liuchuancong/pure_live'
    TARGET_REPO = 'Going2024/pure_live'
    GH_TOKEN = os.getenv('GH_TOKEN')

    # åˆå§‹åŒ– GitHub å®¢æˆ·ç«¯
    g = Github(GH_TOKEN)
    upstream = g.get_repo(UPSTREAM_REPO)
    target = g.get_repo(TARGET_REPO)

    # è·å–ç›®æ ‡ä»“åº“ç°æœ‰ releases
    existing_releases = {}
    for release in target.get_releases():
        existing_releases[release.tag_name] = release

    # åŒæ­¥æ‰€æœ‰ releases
    for release in upstream.get_releases():
        print(f\"\\nğŸ” å¤„ç† Release: {release.title} ({release.tag_name})\")
        
        # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        if release.tag_name in existing_releases:
            print(f\"â© å·²å­˜åœ¨, è·³è¿‡: {release.tag_name}\")
            continue
        
        # åˆ›å»ºæ–° release
        print(f\"ğŸš€ åˆ›å»ºæ–° Release: {release.tag_name}\")
        try:
            new_release = target.create_git_release(
                tag=release.tag_name,
                name=release.title,
                message=release.body,
                draft=release.draft,
                prerelease=release.prerelease
            )
        except GithubException as e:
            # å¦‚æœæ ‡ç­¾å·²å­˜åœ¨ä½†æ—  Releaseï¼Œåˆ™ç›´æ¥åˆ›å»º
            if 'already exists' in str(e):
                print('â„¹ï¸ æ ‡ç­¾å·²å­˜åœ¨ï¼Œåˆ›å»ºå…³è”çš„ Release')
                new_release = target.create_git_release(
                    tag=release.tag_name,
                    name=release.title,
                    message=release.body,
                    draft=release.draft,
                    prerelease=release.prerelease
                )
            else:
                print(f\"âŒ åˆ›å»ºå¤±è´¥: {str(e)}\")
                continue
        
        # åŒæ­¥é™„ä»¶
        assets = release.get_assets()
        if assets.totalCount > 0:
            print(f\"ğŸ“ å‘ç° {assets.totalCount} ä¸ªé™„ä»¶\")
            
            for asset in assets:
                print(f\"â¬‡ï¸ ä¸‹è½½é™„ä»¶: {asset.name} ({asset.size/1024/1024:.2f}MB)\")
                
                # ä¸‹è½½é™„ä»¶
                headers = {'Authorization': f'token {GH_TOKEN}', 'Accept': 'application/octet-stream'}
                response = requests.get(asset.url, headers=headers, stream=True)
                
                if response.status_code == 200:
                    # ä¸Šä¼ é™„ä»¶
                    print(f\"â¬†ï¸ ä¸Šä¼ é™„ä»¶: {asset.name}\")
                    try:
                        new_release.upload_asset(
                            name=asset.name,
                            content_type=asset.content_type,
                            file=response.content
                        )
                        print(f\"âœ… ä¸Šä¼ æˆåŠŸ: {asset.name}\")
                    except GithubException as e:
                        print(f\"âŒ ä¸Šä¼ å¤±è´¥: {str(e)}\")
                else:
                    print(f\"âŒ ä¸‹è½½å¤±è´¥: {asset.name} (çŠ¶æ€ç : {response.status_code})\")
            
            print(f\"âœ… é™„ä»¶åŒæ­¥å®Œæˆ: {assets.totalCount} ä¸ª\")
        else:
            print('â„¹ï¸ æ— é™„ä»¶')

    print('\\nğŸ‰ æ‰€æœ‰ Releases åŒæ­¥å®Œæˆ!')
    "
